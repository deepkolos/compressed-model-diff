var e=Object.assign;import{P as n,B as i,G as o,D as r,r as t,a,o as s,M as l,W as d,s as f,V as c,b as m,O as u,c as g,d as v,S as p,w as x,A as w,e as h,f as D,g as T,h as b,i as y,j as _,k as C,l as F,m as j,n as z,T as R,F as M,p as L,q as U,v as I,t as O,u as S,x as k,y as P,z as E}from"./vendor.737884a1.js";!function(e=".",n="__import__"){try{self[n]=new Function("u","return import(u)")}catch(i){const o=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[n]=e=>new Promise(((i,t)=>{const a=new URL(e,o);if(self[n].moduleMap[a])return i(self[n].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${n}.moduleMap['${a}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){t(new Error(`Failed to import: ${e}`)),r(l)},onload(){i(self[n].moduleMap[a]),r(l)}});document.head.appendChild(l)})),self[n].moduleMap={}}}("assets/"),n.set(new i);const B={KHR_draco_mesh_compression:"draco",KHR_texture_transform:"texture_transform",KHR_mesh_quantization:"quantization",EXT_meshopt_compression:"meshopt"};var W={setup(){const n=new o,i=new r;i.setDecoderPath("draco/");const C=t(),F=a({wireframe:"false",point:"false",slide:"50",curr:"slide",list:["diff","slide","onion"]}),j=a({left:"",right:"",can:"",leftFile:"",rightFile:""}),z=a({original:0,diff:0}),R=a({original:{size:0,objects:0,vertices:0,triangles:0,loadTime:0,ext:[]},diff:{size:0,objects:0,vertices:0,triangles:0,loadTime:0,ext:[]}});window.addEventListener("dragover",(e=>e.preventDefault())),window.addEventListener("dragenter",(()=>j.can="enter")),window.addEventListener("dragleave",(()=>{j.left||j.right||(j.can="")}));return s((async()=>{const{innerWidth:o,innerHeight:r}=window;n.setMeshoptDecoder(l),n.setDRACOLoader(i);const t=new d({canvas:C.value,antialias:!0,alpha:!0});t.setSize(o,r),t.setPixelRatio(devicePixelRatio),t.outputEncoding=f,window.addEventListener("resize",(()=>{const{innerWidth:e,innerHeight:n}=window;t.setSize(e,n),s.aspect=e/n,s.updateProjectionMatrix(),t.setSize(e,n)}));const a=new c;t.getDrawingBufferSize(a);const s=new m(75,o/r,.01,1e3),M=new u(-1,1,-1,1,.1,1e3);s.position.z=.2;const L=new g(a.x,a.y),U=new g(a.x,a.y);L.texture.encoding=f,U.texture.encoding=f;const I=new v(s,C.value);I.enableDamping=!0,I.dampingFactor=.75;const O=new p,S=new p,k=((e,n)=>{const i=new p,o=new D(2,2,1,1),r=new T({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n\n        void main() {\n          vec4 originalColor = texture2D(originalTex, texcoord);\n          vec4 diffColor = texture2D(diffTex, texcoord);\n          vec4 diff = originalColor - diffColor;\n\n          if (diff.x <= 0.001 && diff.y <= 0.001 && diff.z <= 0.001) {\n            gl_FragColor = vec4(0.0);\n          } else {\n            gl_FragColor = vec4(vec3(diff.x + diff.y + diff.z), 1.0);\n          }\n        }\n        "}),t=new b(o,r),a=new y(.5,.5,1,1),s=new b(a,new _({map:e.texture})),l=new b(a,new _({map:n.texture})),d=.75;return s.position.set(-.75,d,0),l.position.set(d,d,0),l.scale.set(-1,-1,1),s.scale.set(-1,-1,1),i.add(t,s,l),i})(L,U),P=((e,n)=>{const i=new p,o=new D(2,2,1,1),r=new T({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture},slide:{value:.5}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n        uniform float slide;\n\n        void main() {\n          if (texcoord.x < slide) {\n            gl_FragColor = texture2D(originalTex, texcoord);\n          } else {\n            gl_FragColor = texture2D(diffTex, texcoord);\n          }\n        }\n        "}),t=new b(o,r);return x((()=>{r.uniforms.slide.value=~~F.slide/100})),i.add(t),i})(L,U),E=((e,n)=>{const i=new p,o=new D(2,2,1,1),r=new T({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture},slide:{value:.5}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n        uniform float slide;\n\n        void main() {\n          vec3 s_color = texture2D(originalTex, texcoord).xyz * slide;\n          vec3 d_color = texture2D(diffTex, texcoord).xyz * (1.0 - slide);\n          gl_FragColor = vec4(s_color + d_color, 1.0);\n        }\n        "}),t=new b(o,r);return x((()=>{r.uniforms.slide.value=~~F.slide/100})),i.add(t),i})(L,U);let W,A;x((()=>{const e=Date.now();j.leftFile&&n.loadAsync(j.leftFile,(e=>R.original.size=e.total)).then((n=>{R.original.loadTime=Date.now()-e,W&&O.remove(W.scene),W=n,O.add(n.scene),z.original++,R.original.ext=(n.parser.json.extensionsUsed||[]).map((e=>B[e]||e))}))})),x((async()=>{const e=Date.now();j.rightFile&&n.loadAsync(j.rightFile,(e=>R.diff.size=e.total)).then((n=>{R.diff.loadTime=Date.now()-e,A&&S.remove(A.scene),A=n,S.add(n.scene),z.diff++,R.diff.ext=(n.parser.json.extensionsUsed||[]).map((e=>B[e]||e))}))})),x((()=>{const n={objects:0,vertices:0,triangles:0},i={objects:0,vertices:0,triangles:0},o=(e,n)=>{if(e instanceof b&&e.material&&(e.material.wireframe=F.wireframe),n.objects++,e instanceof b){const i=e.geometry;i.isBufferGeometry&&(n.vertices+=i.attributes.position.count,null!==i.index?n.triangles+=i.index.count/3:n.triangles+=i.attributes.position.count/3)}};console.log(z.original,z.diff),null==W||W.scene.traverse((e=>o(e,n))),null==A||A.scene.traverse((e=>o(e,i))),R.original=e(e({},R.original),n),R.diff=e(e({},R.diff),i)})),O.add(new w(16777215,1)),O.add(new h(16777215,1)),S.add(new w(16777215,1)),S.add(new h(16777215,1));const H={diff:k,slide:P,onion:E},q=()=>{requestAnimationFrame(q),I.update(),t.setRenderTarget(L),t.render(O,s),t.setRenderTarget(U),t.render(S,s),t.setRenderTarget(null),t.render(H[F.curr],M)};q()})),{canvas:C,modeCfg:F,drop:j,modelInfo:R,onDiffModelDrop:e=>{if(e.preventDefault(),e.dataTransfer){const n=e.dataTransfer.files.item(0);n&&(j.rightFile=URL.createObjectURL(n))}j.right="",j.can=""},onOriginalModelDrop:e=>{if(e.preventDefault(),e.dataTransfer){const n=e.dataTransfer.files.item(0);n&&(j.leftFile=URL.createObjectURL(n))}j.left="",j.can=""}}}};const A=j("a",{class:"title",href:"https://github.com/deepkolos/compressed-model-diff",draggable:"false"},"Compressed-Model-Diff",-1),H={class:"canvas",ref:"canvas"},q={key:0,class:"usage-can"},$=j("div",{class:"usage"},"请把模型文件拖入左右两边",-1),K={class:"setting",draggable:"false"},V={class:"mode-can"},G={for:"wireframe-checkbox"},X=k("线框模式 "),J={class:"info-can"},N=j("div",{class:"info-first"},"left",-1),Q=j("div",null,"right",-1),Y=j("div",{class:"info-metrics"},"size",-1),Z=j("div",{class:"info-metrics"},"load",-1),ee=j("div",{class:"info-metrics"},"objects",-1),ne=j("div",{class:"info-metrics"},"vertices",-1),ie=j("div",{class:"info-metrics"},"triangles",-1),oe=j("div",{class:"info-metrics"},"extensions",-1);W.render=function(e,n,i,o,r,t){return C(),F(M,null,[A,j("canvas",H,null,512),j(R,{name:"fade",appear:""},{default:z((()=>[o.drop.leftFile||o.drop.rightFile?P("",!0):(C(),F("div",q,[$]))])),_:1}),j("div",K,[j("div",V,[(C(!0),F(M,null,L(o.modeCfg.list,(e=>(C(),F("div",{draggable:"false",class:["mode",{active:e===o.modeCfg.curr}],onClick:()=>o.modeCfg.curr=e},S(e),11,["onClick"])))),256))]),j("label",G,[U(j("input",{id:"wireframe-checkbox",type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=e=>o.modeCfg.wireframe=e)},null,512),[[I,o.modeCfg.wireframe]]),X]),U(j("input",{class:"slider",type:"range",min:"0",max:"100",step:"1","onUpdate:modelValue":n[2]||(n[2]=e=>o.modeCfg.slide=e)},null,512),[[O,o.modeCfg.slide]])]),j("div",J,[N,Q,Y,j("div",null,S((o.modelInfo.original.size/1024/1024).toFixed(2))+"MB",1),j("div",null,S((o.modelInfo.diff.size/1024/1024).toFixed(2))+"MB",1),Z,j("div",null,S(o.modelInfo.original.loadTime)+"ms",1),j("div",null,S(o.modelInfo.diff.loadTime)+"ms",1),ee,j("div",null,S(o.modelInfo.original.objects),1),j("div",null,S(o.modelInfo.diff.objects),1),ne,j("div",null,S(o.modelInfo.original.vertices),1),j("div",null,S(o.modelInfo.diff.vertices),1),ie,j("div",null,S(o.modelInfo.original.triangles),1),j("div",null,S(o.modelInfo.diff.triangles),1),oe,j("div",null,[(C(!0),F(M,null,L(o.modelInfo.original.ext,(e=>(C(),F("div",null,S(e),1)))),256))]),j("div",null,[(C(!0),F(M,null,L(o.modelInfo.diff.ext,(e=>(C(),F("div",null,S(e),1)))),256))])]),j("div",{class:["drop-can",o.drop.can],draggable:"false"},[j("div",{class:["drop",o.drop.left],onDragenter:n[3]||(n[3]=()=>o.drop.left="enter"),onDragleave:n[4]||(n[4]=()=>o.drop.left=""),onDrop:n[5]||(n[5]=(...e)=>o.onOriginalModelDrop&&o.onOriginalModelDrop(...e))},"左模型",34),j("div",{class:["drop",o.drop.right],onDragenter:n[6]||(n[6]=()=>o.drop.right="enter"),onDragleave:n[7]||(n[7]=()=>o.drop.right=""),onDrop:n[8]||(n[8]=(...e)=>o.onDiffModelDrop&&o.onDiffModelDrop(...e))},"右模型",34)],2)],64)},E(W).mount("#app");
