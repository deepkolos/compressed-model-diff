var e=Object.assign;import{G as n,D as i,r as o,a as r,o as t,M as a,W as s,s as l,V as d,P as f,O as c,b as u,c as m,S as g,w as v,A as p,d as x,e as w,f as h,g as D,B as b,h as y,i as T,j as _,k as C,l as F,T as j,F as z,m as R,n as M,v as L,p as U,t as I,q as O,u as S,x as k}from"./vendor.73f901b9.js";!function(e=".",n="__import__"){try{self[n]=new Function("u","return import(u)")}catch(i){const o=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[n]=e=>new Promise(((i,t)=>{const a=new URL(e,o);if(self[n].moduleMap[a])return i(self[n].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${n}.moduleMap['${a}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){t(new Error(`Failed to import: ${e}`)),r(l)},onload(){i(self[n].moduleMap[a]),r(l)}});document.head.appendChild(l)})),self[n].moduleMap={}}}("/assets/");const P={KHR_draco_mesh_compression:"draco",KHR_texture_transform:"texture_transform",KHR_mesh_quantization:"quantization",EXT_meshopt_compression:"meshopt"};var E={setup(){const T=new n,_=new i;_.setDecoderPath("draco/");const C=o(),F=r({wireframe:"false",point:"false",slide:"50",curr:"slide",list:["diff","slide","onion"]}),j=r({left:"",right:"",can:"",leftFile:"",rightFile:""}),z=r({original:0,diff:0}),R=r({original:{size:0,objects:0,vertices:0,triangles:0,ext:[]},diff:{size:0,objects:0,vertices:0,triangles:0,ext:[]}});window.addEventListener("dragover",(e=>e.preventDefault())),window.addEventListener("dragenter",(()=>j.can="enter")),window.addEventListener("dragleave",(()=>{j.left||j.right||(j.can="")}));return t((async()=>{const{innerWidth:n,innerHeight:i}=window;T.setMeshoptDecoder(a),T.setDRACOLoader(_);const o=new s({canvas:C.value,antialias:!0,alpha:!0});o.setSize(n,i),o.setPixelRatio(devicePixelRatio),o.outputEncoding=l,window.addEventListener("resize",(()=>{const{innerWidth:e,innerHeight:n}=window;o.setSize(e,n),t.aspect=e/n,t.updateProjectionMatrix(),o.setSize(e,n)}));const r=new d;o.getDrawingBufferSize(r);const t=new f(75,n/i,.1,1e3),M=new c(-1,1,-1,1,.1,1e3);t.position.z=.2;const L=new u(r.x,r.y),U=new u(r.x,r.y);L.texture.encoding=l,U.texture.encoding=l;const I=new m(t,C.value);I.enableDamping=!0,I.dampingFactor=.75;const O=new g,S=new g,k=((e,n)=>{const i=new g,o=new w(2,2,1,1),r=new h({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n\n        void main() {\n          vec4 originalColor = texture2D(originalTex, texcoord);\n          vec4 diffColor = texture2D(diffTex, texcoord);\n          vec4 diff = originalColor - diffColor;\n\n          if (diff.x <= 0.001 && diff.y <= 0.001 && diff.z <= 0.001) {\n            gl_FragColor = vec4(0.0);\n          } else {\n            gl_FragColor = vec4(vec3(diff.x + diff.y + diff.z), 1.0);\n          }\n        }\n        "}),t=new D(o,r),a=new b(.5,.5,1,1),s=new D(a,new y({map:e.texture})),l=new D(a,new y({map:n.texture})),d=.75;return s.position.set(-.75,d,0),l.position.set(d,d,0),l.scale.set(-1,-1,1),s.scale.set(-1,-1,1),i.add(t,s,l),i})(L,U),E=((e,n)=>{const i=new g,o=new w(2,2,1,1),r=new h({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture},slide:{value:.5}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n        uniform float slide;\n\n        void main() {\n          if (texcoord.x < slide) {\n            gl_FragColor = texture2D(originalTex, texcoord);\n          } else {\n            gl_FragColor = texture2D(diffTex, texcoord);\n          }\n        }\n        "}),t=new D(o,r);return v((()=>{r.uniforms.slide.value=~~F.slide/100})),i.add(t),i})(L,U),B=((e,n)=>{const i=new g,o=new w(2,2,1,1),r=new h({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture},slide:{value:.5}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n        uniform float slide;\n\n        void main() {\n          vec3 s_color = texture2D(originalTex, texcoord).xyz * slide;\n          vec3 d_color = texture2D(diffTex, texcoord).xyz * (1.0 - slide);\n          gl_FragColor = vec4(s_color + d_color, 1.0);\n        }\n        "}),t=new D(o,r);return v((()=>{r.uniforms.slide.value=~~F.slide/100})),i.add(t),i})(L,U);let W,A;v((()=>{j.leftFile&&T.loadAsync(j.leftFile,(e=>R.original.size=e.total)).then((e=>{W&&O.remove(W.scene),W=e,O.add(e.scene),z.original++,R.original.ext=(e.parser.json.extensionsUsed||[]).map((e=>P[e]||e))}))})),v((async()=>{j.rightFile&&T.loadAsync(j.rightFile,(e=>R.diff.size=e.total)).then((e=>{A&&S.remove(A.scene),A=e,S.add(e.scene),z.diff++,R.diff.ext=(e.parser.json.extensionsUsed||[]).map((e=>P[e]||e))}))})),v((()=>{const n={objects:0,vertices:0,triangles:0},i={objects:0,vertices:0,triangles:0},o=(e,n)=>{if(e instanceof D&&e.material&&(e.material.wireframe=F.wireframe),n.objects++,e instanceof D){const i=e.geometry;i.isBufferGeometry&&(n.vertices+=i.attributes.position.count,null!==i.index?n.triangles+=i.index.count/3:n.triangles+=i.attributes.position.count/3)}};console.log(z.original,z.diff),null==W||W.scene.traverse((e=>o(e,n))),null==A||A.scene.traverse((e=>o(e,i))),R.original=e(e({},R.original),n),R.diff=e(e({},R.diff),i)})),O.add(new p(16777215,1)),O.add(new x(16777215,1)),S.add(new p(16777215,1)),S.add(new x(16777215,1));const H={diff:k,slide:E,onion:B},q=()=>{requestAnimationFrame(q),I.update(),o.setRenderTarget(L),o.render(O,t),o.setRenderTarget(U),o.render(S,t),o.setRenderTarget(null),o.render(H[F.curr],M)};q()})),{canvas:C,modeCfg:F,drop:j,modelInfo:R,onDiffModelDrop:e=>{if(e.preventDefault(),e.dataTransfer){const n=e.dataTransfer.files.item(0);n&&(j.rightFile=URL.createObjectURL(n))}j.right="",j.can=""},onOriginalModelDrop:e=>{if(e.preventDefault(),e.dataTransfer){const n=e.dataTransfer.files.item(0);n&&(j.leftFile=URL.createObjectURL(n))}j.left="",j.can=""}}}};const B=C("a",{class:"title",href:"https://github.com/deepkolos/compressed-model-diff",draggable:"false"},"Compressed-Model-Diff",-1),W={class:"canvas",ref:"canvas"},A={key:0,class:"usage"},H={class:"setting",draggable:"false"},q={class:"mode-can"},$={for:"wireframe-checkbox"},K=O("线框模式 "),V={class:"info-can"},G=C("div",{class:"info-first"},"left",-1),X=C("div",null,"right",-1),J=C("div",{class:"info-metrics"},"size",-1),N=C("div",{class:"info-metrics"},"objects",-1),Q=C("div",{class:"info-metrics"},"vertices",-1),Y=C("div",{class:"info-metrics"},"triangles",-1),Z=C("div",{class:"info-metrics"},"extensions",-1);E.render=function(e,n,i,o,r,t){return T(),_(z,null,[B,C("canvas",W,null,512),C(j,{name:"fade",appear:""},{default:F((()=>[o.drop.leftFile||o.drop.rightFile?S("",!0):(T(),_("div",A," 请把模型文件拖入左右两边 "))])),_:1}),C("div",H,[C("div",q,[(T(!0),_(z,null,R(o.modeCfg.list,(e=>(T(),_("div",{draggable:"false",class:["mode",{active:e===o.modeCfg.curr}],onClick:()=>o.modeCfg.curr=e},I(e),11,["onClick"])))),256))]),C("label",$,[M(C("input",{id:"wireframe-checkbox",type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=e=>o.modeCfg.wireframe=e)},null,512),[[L,o.modeCfg.wireframe]]),K]),M(C("input",{class:"slider",type:"range",min:"0",max:"100",step:"1","onUpdate:modelValue":n[2]||(n[2]=e=>o.modeCfg.slide=e)},null,512),[[U,o.modeCfg.slide]])]),C("div",V,[G,X,J,C("div",null,I((o.modelInfo.original.size/1024/1024).toFixed(2))+"MB",1),C("div",null,I((o.modelInfo.diff.size/1024/1024).toFixed(2))+"MB",1),N,C("div",null,I(o.modelInfo.original.objects),1),C("div",null,I(o.modelInfo.diff.objects),1),Q,C("div",null,I(o.modelInfo.original.vertices),1),C("div",null,I(o.modelInfo.diff.vertices),1),Y,C("div",null,I(o.modelInfo.original.triangles),1),C("div",null,I(o.modelInfo.diff.triangles),1),Z,C("div",null,[(T(!0),_(z,null,R(o.modelInfo.original.ext,(e=>(T(),_("div",null,I(e),1)))),256))]),C("div",null,[(T(!0),_(z,null,R(o.modelInfo.diff.ext,(e=>(T(),_("div",null,I(e),1)))),256))])]),C("div",{class:["drop-can",o.drop.can],draggable:"false"},[C("div",{class:["drop",o.drop.left],onDragenter:n[3]||(n[3]=()=>o.drop.left="enter"),onDragleave:n[4]||(n[4]=()=>o.drop.left=""),onDrop:n[5]||(n[5]=(...e)=>o.onOriginalModelDrop&&o.onOriginalModelDrop(...e))}," 左模型 ",34),C("div",{class:["drop",o.drop.right],onDragenter:n[6]||(n[6]=()=>o.drop.right="enter"),onDragleave:n[7]||(n[7]=()=>o.drop.right=""),onDrop:n[8]||(n[8]=(...e)=>o.onDiffModelDrop&&o.onDiffModelDrop(...e))}," 右模型 ",34)],2)],64)},k(E).mount("#app");
