var e=Object.defineProperty,n=Object.prototype.hasOwnProperty,i=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,r=(n,i,o)=>i in n?e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[i]=o,t=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&r(e,a,t[a]);if(i)for(var a of i(t))o.call(t,a)&&r(e,a,t[a]);return e};import{P as a,B as s,G as l,D as d,r as f,a as c,o as m,M as u,W as v,s as g,V as p,b as x,O as w,c as h,d as D,S as b,w as y,A as T,e as _,f as j,g as C,h as F,i as z,j as R,k as M,l as O,m as L,n as I,T as U,F as P,p as S,q as k,v as E,t as B,u as W,x as A,y as H,z as q}from"./vendor.83fe382f.js";!function(e=".",n="__import__"){try{self[n]=new Function("u","return import(u)")}catch(i){const o=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[n]=e=>new Promise(((i,t)=>{const a=new URL(e,o);if(self[n].moduleMap[a])return i(self[n].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${n}.moduleMap['${a}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){t(new Error(`Failed to import: ${e}`)),r(l)},onload(){i(self[n].moduleMap[a]),r(l)}});document.head.appendChild(l)})),self[n].moduleMap={}}}("assets/"),a.set(new s);const $={KHR_draco_mesh_compression:"draco",KHR_texture_transform:"texture_transform",KHR_mesh_quantization:"quantization",EXT_meshopt_compression:"meshopt"};var K={setup(){const e=new l,n=new d;n.setDecoderPath("draco/");const i=f(),o=c({wireframe:"false",point:"false",slide:"50",curr:"slide",list:["diff","slide","onion"]}),r=c({left:"",right:"",can:"",leftFile:"",rightFile:""}),a=c({original:0,diff:0}),s=c({original:{size:0,objects:0,vertices:0,triangles:0,loadTime:0,ext:[]},diff:{size:0,objects:0,vertices:0,triangles:0,loadTime:0,ext:[]}});window.addEventListener("dragover",(e=>e.preventDefault())),window.addEventListener("dragenter",(()=>r.can="enter")),window.addEventListener("dragleave",(()=>{r.left||r.right||(r.can="")}));return m((async()=>{const{innerWidth:l,innerHeight:d}=window;e.setMeshoptDecoder(u),e.setDRACOLoader(n);const f=new v({canvas:i.value,antialias:!0,alpha:!0});f.setSize(l,d),f.setPixelRatio(devicePixelRatio),f.outputEncoding=g,window.addEventListener("resize",(()=>{const{innerWidth:e,innerHeight:n}=window;f.setSize(e,n),m.aspect=e/n,m.updateProjectionMatrix(),f.setSize(e,n)}));const c=new p;f.getDrawingBufferSize(c);const m=new x(75,l/d,.01,1e3),M=new w(-1,1,-1,1,.1,1e3);m.position.z=.2;const O=new h(c.x,c.y),L=new h(c.x,c.y);O.texture.encoding=g,L.texture.encoding=g;const I=new D(m,i.value);I.enableDamping=!0,I.dampingFactor=.75;const U=new b,P=new b,S=((e,n)=>{const i=new b,o=new j(2,2,1,1),r=new C({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n\n        void main() {\n          vec4 originalColor = texture2D(originalTex, texcoord);\n          vec4 diffColor = texture2D(diffTex, texcoord);\n          vec4 diff = originalColor - diffColor;\n\n          if (diff.x <= 0.001 && diff.y <= 0.001 && diff.z <= 0.001) {\n            gl_FragColor = vec4(0.0);\n          } else {\n            gl_FragColor = vec4(vec3(diff.x + diff.y + diff.z), 1.0);\n          }\n        }\n        "}),t=new F(o,r),a=new z(.5,.5,1,1),s=new F(a,new R({map:e.texture})),l=new F(a,new R({map:n.texture})),d=.75;return s.position.set(-.75,d,0),l.position.set(d,d,0),l.scale.set(-1,-1,1),s.scale.set(-1,-1,1),i.add(t,s,l),i})(O,L),k=((e,n)=>{const i=new b,r=new j(2,2,1,1),t=new C({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture},slide:{value:.5}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n        uniform float slide;\n\n        void main() {\n          if (texcoord.x < slide) {\n            gl_FragColor = texture2D(originalTex, texcoord);\n          } else {\n            gl_FragColor = texture2D(diffTex, texcoord);\n          }\n        }\n        "}),a=new F(r,t);return y((()=>{t.uniforms.slide.value=~~o.slide/100})),i.add(a),i})(O,L),E=((e,n)=>{const i=new b,r=new j(2,2,1,1),t=new C({uniforms:{originalTex:{value:e.texture},diffTex:{value:n.texture},slide:{value:.5}},depthWrite:!1,vertexShader:"\n        varying vec2 texcoord;\n\n        void main() {\n          texcoord = uv;\n          gl_Position = vec4(position.xy, 0.0, 1.0);\n        }",fragmentShader:"\n        varying vec2 texcoord;\n        uniform sampler2D originalTex;\n        uniform sampler2D diffTex;\n        uniform float slide;\n\n        void main() {\n          vec3 s_color = texture2D(originalTex, texcoord).xyz * slide;\n          vec3 d_color = texture2D(diffTex, texcoord).xyz * (1.0 - slide);\n          gl_FragColor = vec4(s_color + d_color, 1.0);\n        }\n        "}),a=new F(r,t);return y((()=>{t.uniforms.slide.value=~~o.slide/100})),i.add(a),i})(O,L);let B,W;y((()=>{const n=Date.now();r.leftFile&&e.loadAsync(r.leftFile,(e=>s.original.size=e.total)).then((e=>{s.original.loadTime=Date.now()-n,B&&U.remove(B.scene),B=e,U.add(e.scene),a.original++,s.original.ext=(e.parser.json.extensionsUsed||[]).map((e=>$[e]||e))}))})),y((async()=>{const n=Date.now();r.rightFile&&e.loadAsync(r.rightFile,(e=>s.diff.size=e.total)).then((e=>{s.diff.loadTime=Date.now()-n,W&&P.remove(W.scene),W=e,P.add(e.scene),a.diff++,s.diff.ext=(e.parser.json.extensionsUsed||[]).map((e=>$[e]||e))}))})),y((()=>{const e={objects:0,vertices:0,triangles:0},n={objects:0,vertices:0,triangles:0},i=(e,n)=>{if(e instanceof F&&e.material&&(e.material.wireframe=o.wireframe),n.objects++,e instanceof F){const i=e.geometry;i.isBufferGeometry&&(n.vertices+=i.attributes.position.count,null!==i.index?n.triangles+=i.index.count/3:n.triangles+=i.attributes.position.count/3)}};console.log(a.original,a.diff),null==B||B.scene.traverse((n=>i(n,e))),null==W||W.scene.traverse((e=>i(e,n))),s.original=t(t({},s.original),e),s.diff=t(t({},s.diff),n)})),U.add(new T(16777215,1)),U.add(new _(16777215,1)),P.add(new T(16777215,1)),P.add(new _(16777215,1));const A={diff:S,slide:k,onion:E},H=()=>{requestAnimationFrame(H),I.update(),f.setRenderTarget(O),f.render(U,m),f.setRenderTarget(L),f.render(P,m),f.setRenderTarget(null),f.render(A[o.curr],M)};H()})),{canvas:i,modeCfg:o,drop:r,modelInfo:s,onDiffModelDrop:e=>{if(e.preventDefault(),e.dataTransfer){const n=e.dataTransfer.files.item(0);n&&(r.rightFile=URL.createObjectURL(n))}r.right="",r.can=""},onOriginalModelDrop:e=>{if(e.preventDefault(),e.dataTransfer){const n=e.dataTransfer.files.item(0);n&&(r.leftFile=URL.createObjectURL(n))}r.left="",r.can=""}}}};const V=L("a",{class:"title",href:"https://github.com/deepkolos/compressed-model-diff",draggable:"false"},"Compressed-Model-Diff",-1),G={class:"canvas",ref:"canvas"},X={key:0,class:"usage-can"},J=L("div",{class:"usage"},"请把模型文件拖入左右两边",-1),N={class:"setting",draggable:"false"},Q={class:"mode-can"},Y={for:"wireframe-checkbox"},Z=A("线框模式 "),ee={class:"info-can"},ne=L("div",{class:"info-first"},"left",-1),ie=L("div",null,"right",-1),oe=L("div",{class:"info-metrics"},"size",-1),re=L("div",{class:"info-metrics"},"load",-1),te=L("div",{class:"info-metrics"},"objects",-1),ae=L("div",{class:"info-metrics"},"vertices",-1),se=L("div",{class:"info-metrics"},"triangles",-1),le=L("div",{class:"info-metrics"},"extensions",-1);K.render=function(e,n,i,o,r,t){return M(),O(P,null,[V,L("canvas",G,null,512),L(U,{name:"fade",appear:""},{default:I((()=>[o.drop.leftFile||o.drop.rightFile?H("",!0):(M(),O("div",X,[J]))])),_:1}),L("div",N,[L("div",Q,[(M(!0),O(P,null,S(o.modeCfg.list,(e=>(M(),O("div",{draggable:"false",class:["mode",{active:e===o.modeCfg.curr}],onClick:()=>o.modeCfg.curr=e},W(e),11,["onClick"])))),256))]),L("label",Y,[k(L("input",{id:"wireframe-checkbox",type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=e=>o.modeCfg.wireframe=e)},null,512),[[E,o.modeCfg.wireframe]]),Z]),k(L("input",{class:"slider",type:"range",min:"0",max:"100",step:"1","onUpdate:modelValue":n[2]||(n[2]=e=>o.modeCfg.slide=e)},null,512),[[B,o.modeCfg.slide]])]),L("div",ee,[ne,ie,oe,L("div",null,W((o.modelInfo.original.size/1024/1024).toFixed(2))+"MB",1),L("div",null,W((o.modelInfo.diff.size/1024/1024).toFixed(2))+"MB",1),re,L("div",null,W(o.modelInfo.original.loadTime)+"ms",1),L("div",null,W(o.modelInfo.diff.loadTime)+"ms",1),te,L("div",null,W(o.modelInfo.original.objects),1),L("div",null,W(o.modelInfo.diff.objects),1),ae,L("div",null,W(o.modelInfo.original.vertices),1),L("div",null,W(o.modelInfo.diff.vertices),1),se,L("div",null,W(o.modelInfo.original.triangles),1),L("div",null,W(o.modelInfo.diff.triangles),1),le,L("div",null,[(M(!0),O(P,null,S(o.modelInfo.original.ext,(e=>(M(),O("div",null,W(e),1)))),256))]),L("div",null,[(M(!0),O(P,null,S(o.modelInfo.diff.ext,(e=>(M(),O("div",null,W(e),1)))),256))])]),L("div",{class:["drop-can",o.drop.can],draggable:"false"},[L("div",{class:["drop",o.drop.left],onDragenter:n[3]||(n[3]=()=>o.drop.left="enter"),onDragleave:n[4]||(n[4]=()=>o.drop.left=""),onDrop:n[5]||(n[5]=(...e)=>o.onOriginalModelDrop&&o.onOriginalModelDrop(...e))},"左模型",34),L("div",{class:["drop",o.drop.right],onDragenter:n[6]||(n[6]=()=>o.drop.right="enter"),onDragleave:n[7]||(n[7]=()=>o.drop.right=""),onDrop:n[8]||(n[8]=(...e)=>o.onDiffModelDrop&&o.onDiffModelDrop(...e))},"右模型",34)],2)],64)},q(K).mount("#app");
